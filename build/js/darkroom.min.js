!function(window,document,fabric){"use strict";function extend(b,a){var prop;if(void 0===b)return a;for(prop in a)a.hasOwnProperty(prop)&&b.hasOwnProperty(prop)===!1&&(b[prop]=a[prop]);return b}function Darkroom(element,options,plugins){return this.init(element,options,plugins)}function Plugin(darkroom,options){this.darkroom=darkroom,this.options=extend(options,this.defaults),this.initialize()}function Toolbar(element){this.element=element,this.actionsElement=element.querySelector(".darkroom-toolbar-actions")}function ButtonGroup(element){this.element=element}function Button(element){this.element=element}window.Darkroom=Darkroom,Darkroom.plugins=[],Plugin.prototype={defaults:{},initialize:function(){}},Plugin.extend=function(protoProps){var child,parent=this;child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},extend(child,parent);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&extend(child.prototype,protoProps),child.__super__=parent.prototype,child},Darkroom.Plugin=Plugin,Toolbar.prototype.createButtonGroup=function(){var buttonGroup=document.createElement("li");return buttonGroup.className="darkroom-button-group",this.actionsElement.appendChild(buttonGroup),new ButtonGroup(buttonGroup)},ButtonGroup.prototype.createButton=function(options){var defaults={image:"help",type:"default",group:"default",hide:!1,disabled:!1};options=extend(options,defaults);var button=document.createElement("button");button.className="darkroom-button darkroom-button-"+options.type,button.innerHTML='<i class="darkroom-icon-'+options.image+'"></i>',this.element.appendChild(button);var button=new Button(button);return button.hide(options.hide),button.disable(options.disabled),button},Button.prototype={addEventListener:function(eventName,callback){var el=this.element;el.addEventListener?el.addEventListener(eventName,callback):el.attachEvent&&el.attachEvent("on"+eventName,callback)},active:function(value){value?this.element.classList.add("darkroom-button-active"):this.element.classList.remove("darkroom-button-active")},hide:function(value){value?this.element.classList.add("darkroom-button-hidden"):this.element.classList.remove("darkroom-button-hidden")},disable:function(value){this.element.disabled=value?!0:!1}};var Canvas=fabric.util.createClass(fabric.Canvas,{});Darkroom.prototype={defaults:{minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,plugins:{},init:function(){}},addEventListener:function(eventName,callback){var el=this.canvas.getElement();el.addEventListener?el.addEventListener(eventName,callback):el.attachEvent&&el.attachEvent("on"+eventName,callback)},dispatchEvent:function(eventName){var event=document.createEvent("Event");event.initEvent(eventName,!0,!0),this.canvas.getElement().dispatchEvent(event)},init:function(element,options,plugins){var _this=this;if(this.options=extend(options,this.defaults),"string"==typeof element&&(element=document.querySelector(element)),null!==element){var plugins=plugins||Darkroom.plugins,image=new Image;image.onload=function(){_this.createFabricImage(element).initDOM(element).initPlugins(plugins),_this.options.init.bind(_this).call()},image.src=element.src}},initDOM:function(element){var toolbar=document.createElement("div");toolbar.className="darkroom-toolbar",toolbar.innerHTML='<ul class="darkroom-toolbar-actions"></ul>';var canvas=document.createElement("canvas"),canvasContainer=document.createElement("div");return canvasContainer.className="darkroom-image-container",canvasContainer.appendChild(canvas),this.container=document.createElement("div"),this.container.className="darkroom-container",this.container.appendChild(toolbar),this.container.appendChild(canvasContainer),element.parentNode.replaceChild(this.container,element),this.toolbar=new Toolbar(toolbar),this.canvas=new Canvas(canvas,{selection:!1,backgroundColor:"#ccc"}),this.canvas.setWidth(this.image.getWidth()),this.canvas.setHeight(this.image.getHeight()),this.canvas.add(this.image),this.canvas.centerObject(this.image),this.image.setCoords(),this},createFabricImage:function(imgElement){var width=imgElement.width,height=imgElement.height,scaleMin=1,scaleMax=1,scaleX=1,scaleY=1;null!==this.options.maxWidth&&this.options.maxWidth<width&&(scaleX=this.options.maxWidth/width),null!==this.options.maxHeight&&this.options.maxHeight<height&&(scaleY=this.options.maxHeight/height),scaleMin=Math.min(scaleX,scaleY),scaleX=1,scaleY=1,null!==this.options.minWidth&&this.options.minWidth>width&&(scaleX=this.options.minWidth/width),null!==this.options.minHeight&&this.options.minHeight>height&&(scaleY=this.options.minHeight/height),scaleMax=Math.max(scaleX,scaleY);var scale=scaleMax*scaleMin;return width*=scale,height*=scale,this.image=new fabric.Image(imgElement,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1}),this.image.setScaleX(scale),this.image.setScaleY(scale),this},initPlugins:function(plugins){this.plugins={};for(var name in plugins){var plugin=plugins[name],options=this.options.plugins[name];options!==!1&&(this.plugins[name]=new plugin(this,options))}},getPlugin:function(name){return this.plugins[name]},selfDestroy:function(){var container=this.container,image=new Image;image.onload=function(){container.parentNode.replaceChild(image,container)},image.src=this.snapshotImage()},snapshotImage:function(){return this.image.toDataURL()}}}(window,window.document,fabric);
//# sourceMappingURL=darkroom.min.js.map